generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Admin {
    id            String         @id @default(cuid())
    createdAt     DateTime       @default(now())
    updatedAt     DateTime       @updatedAt
    email         String         @unique
    type          String //admin, moder, org-owner, org-moder
    name          String?
    password      String?
    repassword    String?
    phone         String?
    block         Boolean        @default(false)
    delete        Boolean        @default(false)
    organizations Organization[]
}

model User {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    name      String?
    phone     String   @unique
    code      String   @default("0000")
    email     String?
    block     Boolean  @default(false)
    delete    Boolean  @default(false)
    avatar    String?
    orders    Order[] // заказы пользователя
    pets      Pet[] // питомцы пользователя
}

//Ветеринарная клиника
model Organization {
    id          String     @id @default(cuid())
    createdAt   DateTime   @default(now())
    updatedAt   DateTime   @updatedAt
    publish     Boolean    @default(true) // статус публикации
    delete      Boolean    @default(false) // статус удаления
    name        String // название организации
    logo        String // логотип организации
    description String // описание организации
    city        String? // город* данный параметр пока не будет использоваться
    address     String // адрес физического расположения
    phone       String // контактный телефон организации
    email       String // контактный адрес эл. почты организации
    links       String[] // массив ссылок на сторонние ресурсы
    images      String[] // массив изображений
    categories  String[] // категория оргаизации: vet, salon, shop
    admins      Admin[] // администраторы и модераторы организации
    schedule    Schedule[] // расписание времени работы
    goods       Good[] // товары и услуги которые предоставляет организация
    stocks      Stock[] // акции организации
    orders      Order[] // список заказов организации
}

// Расписание работы
model Schedule {
    id             String       @id @default(cuid())
    createdAt      DateTime     @default(now())
    updatedAt      DateTime     @updatedAt
    organization   Organization @relation(fields: [organizationId], references: [id])
    organizationId String       @unique
    day            String
    startTime      Int // время начала работы в минутах относительно  00:00
    endTine        Int // время окончания работы в минутах относительно  00:00
    allTime        Boolean      @default(false) // устанавливается true если в этот день работает круглосуточно
}

//Товар или услуга предоставляемая организацией
model Good {
    id             String       @id @default(cuid())
    createdAt      DateTime     @default(now())
    updatedAt      DateTime     @updatedAt
    publish        Boolean      @default(true) // статус публикации
    delete         Boolean      @default(false) // статус удаления
    name           String // название 
    description    String // описание 
    price          Int // цена за оказываемую услугу или товар
    images         String[] // изображения услуги
    organization   Organization @relation(fields: [organizationId], references: [id])
    organizationId String
    type           String // тип товара: service, product, enimal
    carts          Cart[]
}

// Акция 
model Stock {
    id             String       @id @default(cuid())
    createdAt      DateTime     @default(now())
    updatedAt      DateTime     @updatedAt
    publish        Boolean      @default(true) // статус публикации
    delete         Boolean      @default(false) // статус удаления
    deadline       DateTime // срок действия акции до конца дня
    name           String // название акции
    description    String // описание акции
    code           String? // промокод* данный параметр пока не будет использоваться. это на будущее 
    organization   Organization @relation(fields: [organizationId], references: [id])
    organizationId String
}

// Корзина
model Cart {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    count     Int      @default(1) // количестов товара, на услуги не используется
    good      Good     @relation(fields: [goodId], references: [id]) //товар или услуга в корзине
    goodId    String
}

// Заказы
model Order {
    id             String       @id @default(cuid())
    createdAt      DateTime     @default(now())
    updatedAt      DateTime     @updatedAt
    status         String // статус заказа: new, confirmed, done, canceled
    goods          Json[] // копися списка корзины(Cart) или услуг которые заказал клиент
    date           DateTime? // время записи, используется только на услуги
    comment        String? // комментарий к заказу
    user           User         @relation(fields: [userId], references: [id]) // пользователь сделавший заказ
    userId         String
    anotherUser    Json? // контактная информаци если пользователь делает заказ не для себя
    organization   Organization @relation(fields: [organizationId], references: [id])
    organizationId String
}

// Питомец
model Pet {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    birthday  DateTime // дата рождения питомца
    name      String? // имя питомца
    kind      String // вид животного: кошка, собака и.т.д
    breed     String // порода животного
    gender    String // пол животного
    owner     User     @relation(fields: [userId], references: [id])
    userId    String
    parents   Pet[]    @relation("ChildParents") // родителя пиотомца
    childrens Pet[]    @relation("ChildParents") // дети питомца
    images    String[] // изображения питомца или его документов
    ads       Ad[]
}

// Объявления
model Ad {
    id          String   @id @default(cuid())
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
    publish     Boolean  @default(true) // статус публикации
    delete      Boolean  @default(false) // статус удаления
    tite        String // заголовок объявления
    description String // описание объявления
    pet         Pet      @relation(fields: [petId], references: [id]) // можно прикрепить своего питомца если его нужно отдать или продать
    petId       String
    price       Int      @default(0) // цена за предоставляемого питомца 0 - бесплатно
}
